<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5. FAQ • SMARTTR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. FAQ">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SMARTTR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SMARTTR.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Part1.Segmentation.html">1. Imaging, segmentation, and preprocessing</a></li>
    <li><a class="dropdown-item" href="../articles/Part2.Tutorial.html">2. Mapping Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/Part3.Scripting.html">3. Scripting &amp; notebooks</a></li>
    <li><a class="dropdown-item" href="../articles/Part4.Example_Analysis_Notebook.html">4. Example analysis notebook</a></li>
    <li><a class="dropdown-item" href="../articles/Part5.FAQ.html">5. FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/Part6.Development.html">6. Development environment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mjin1812/SMARTTR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>5. FAQ</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mjin1812/SMARTTR/blob/HEAD/vignettes/Part5.FAQ.Rmd" class="external-link"><code>vignettes/Part5.FAQ.Rmd</code></a></small>
      <div class="d-none name"><code>Part5.FAQ.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h2>
<p>Below is an FAQ</p>
<div class="section level3">
<h3 id="hardware-recommendations">Hardware recommendations<a class="anchor" aria-label="anchor" href="#hardware-recommendations"></a>
</h3>
<p>Below are the specs of the computers we use for processing our
datasets.</p>
<ul>
<li>RAM: 64GB</li>
<li>CPU: Intel(R) Core(TM) i9-10900</li>
</ul>
<p>We recommend a minimum of 32 GB of RAM because the image processing
scripts can be intensive.</p>
</div>
<div class="section level3">
<h3 id="os-software-versions">OS &amp; Software versions<a class="anchor" aria-label="anchor" href="#os-software-versions"></a>
</h3>
<ul>
<li>OS: Windows 10</li>
<li>Fiji/ImageJ: 2.9.0 (64-bit)</li>
<li>3D ImageJ Suite: 4.1.5</li>
</ul>
</div>
<div class="section level3">
<h3 id="how-long-should-segmentation-take">How long should segmentation take?<a class="anchor" aria-label="anchor" href="#how-long-should-segmentation-take"></a>
</h3>
<p>It depends on the specs of your computer and the size and specs of
your images. Since our images are somewhat high resolution, and our
image <a href="https://osf.io/bek56" class="external-link">segmentation macro</a> segments in
3D not 2D, it can be relatively computationally intensive. However, it
is easy to process an equivalent dataset of ~150 images over a weekend
using a computer with the recommended hardware specs.</p>
</div>
<div class="section level3">
<h3 id="what-are-some-common-errors-i-might-encounter-either-using-smarttr-or-in-wholebrain">What are some common errors I might encounter either using SMARTTR
or in wholebrain?<a class="anchor" aria-label="anchor" href="#what-are-some-common-errors-i-might-encounter-either-using-smarttr-or-in-wholebrain"></a>
</h3>
<div class="section level4">
<h4 id="r-out-of-bounds-error-during-registration-or-mapping">R out of bounds error during registration or mapping<a class="anchor" aria-label="anchor" href="#r-out-of-bounds-error-during-registration-or-mapping"></a>
</h4>
<p>The most common error encountered during registration or mapping is
an “out of bounds error” where the transformation index is out of
bound.</p>
<p>This is largely due when the detected boundary (blue) around the
border of the tissue is poor a poor fit. Wholebrain fits 32
correspondance points around the detected border to generate a first
pass registration, and if the boundary touches the borders of the
images, or goes outside the borders of the image, it throws this
error.</p>
<figure><img src="../reference/figures/4.733_4_reg_threshold.jpg" alt="Image" style="width: 400px;"><figcaption><em>Good brain contour detection in blue.</em>
</figcaption></figure><div class="section level5">
<h5 id="not-choosing-the-optimal-brain-threshold">Not choosing the optimal brain.threshold<a class="anchor" aria-label="anchor" href="#not-choosing-the-optimal-brain-threshold"></a>
</h5>
<p>Since the detection of the tissue border depends on various factors,
such as image brightness, it is possible that the poor border detection
is due to an poor brain.threshold value. Please check out section 3.1
Detecting brain contours of the Tutorial page to see how to modify the
brain threshold.</p>
</div>
<div class="section level5">
<h5 id="i-cant-get-a-good-first-contour-around-my-brains">I can’t get a good first contour around my brains<a class="anchor" aria-label="anchor" href="#i-cant-get-a-good-first-contour-around-my-brains"></a>
</h5>
<p>Unfortunately, the contour detection can be buggy and inconsistent.
Please check out section 3.1 Detecting brain contours of the tutorial
page to see how to quickly and interactively adjust the brain.threshold
to try out a wide range of values. If no optimal threshold is found, we
recommend increasing the brain.threshold value until the contours
detected are smaller than the actual tissue boundaries. Then proceed
with registration. The first pass registration will be inaccurate. You
can quickly manually correct the correspondance points using the
interactive console interface.</p>
</div>
<div class="section level5">
<h5 id="the-contours-of-my-actual-tissue-are-not-contained-in-the-borders-of-the-image">The contours of my actual tissue are not contained in the borders of
the image<a class="anchor" aria-label="anchor" href="#the-contours-of-my-actual-tissue-are-not-contained-in-the-borders-of-the-image"></a>
</h5>
<p>If the brain contours in the image used for registration, i.e. the
<code>MAX_name.tif</code> in the 1. Imaging, segmentation, and
preprocessing section, are touching the 4 borders of the image, this may
throw an out of bounds error. These images should either be manually
edited in ImageJ to omit brain contours intersecting the image border,
or the original <code>.tif</code> image should be padded with a small
border of black pixels.</p>
</div>
<div class="section level5">
<h5 id="not-choosing-the-right-resize-parameter">Not choosing the right resize parameter<a class="anchor" aria-label="anchor" href="#not-choosing-the-right-resize-parameter"></a>
</h5>
<p>The other scenario that may result in this error is when the size of
the atlas overlay during registration is larger than the tissue
boundary. I’m not sure why this error occurs, but this is corrected by
changing the size of the atlas overlay.</p>
<figure><img src="../reference/figures/5.733_4_registration_uncorrected.jpg" alt="Image" style="width: 500px;"><figcaption><em>First pass registration. The yellow atlas outline (left) needs to
fit within the borders of the tissue boundary.</em>
</figcaption></figure><p>Following boundary detection, change the size of the atlas overlay by
modifying the <code>resize</code> parameter of the filter. The optimal
range will depend on your imaging resolution</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Optimal value range for our imaging resolution is 0.8-0.12</span></span>
<span><span class="co"># Larger resize values result in smaller overlays</span></span>
<span></span>
<span><span class="va">filter</span><span class="op">$</span><span class="va">resize</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> </span></code></pre></div>
</div>
<div class="section level5">
<h5 id="none-of-the-above-fixed-my-issue-">None of the above fixed my issue.<a class="anchor" aria-label="anchor" href="#none-of-the-above-fixed-my-issue-"></a>
</h5>
<p>As SMARTTR is a wrapper around registration and mapping functions in
wholebrain, we also recommend checking out the <a href="https://github.com/tractatus/wholebrain" class="external-link">wholebrain github</a> for
more detailed questions.</p>
</div>
</div>
<div class="section level4">
<h4 id="i-have-damage-to-my-brain-and-i-want-to-exclude-it-from-my-analysis">I have damage to my brain and I want to exclude it from my
analysis<a class="anchor" aria-label="anchor" href="#i-have-damage-to-my-brain-and-i-want-to-exclude-it-from-my-analysis"></a>
</h4>
<p>The ability to process only subsets of regions are built-in to the
SMARTTR package. The sections below are organized in order of increasing
damage severity.</p>
<div class="section level5">
<h5 id="i-only-want-to-exclude-a-subset-of-regions">I only want to exclude a subset of regions<a class="anchor" aria-label="anchor" href="#i-only-want-to-exclude-a-subset-of-regions"></a>
</h5>
<p>This capability is part of the <code><a href="../reference/exclude_anatomy.html">exclude_anatomy()</a></code>
function and is accounted for using the
<code>exclude_right_regions</code> and <code>exclude_left_regions</code>
parameters.</p>
<p>You can enter an character vector of region abbreviations from the <a href="http://atlas.brain-map.org/atlas?atlas=602630314#atlas=602630314&amp;plate=576989940&amp;structure=549&amp;x=5279.800460587686&amp;y=3744.07958984375&amp;zoom=-3&amp;resolution=11.93&amp;z=3" class="external-link">Allen
Brain Ontology</a> to either of these parameters to add additional
regions to exclude. Note that any regions acronyms maintain the
heirarchical nature of the ontology, so if you wanted to exclude the
entire thalamus, instead of listing out every subregion, you can just
enter <code>TH</code>.</p>
<p>Additionally, by default layer 1 of cortical layer, ventricles, and
fiber tracts are already excluded. This is because these are the default
arguments for the <code>left_regions_excluded</code> and
<code>right_regions_excluded</code> parameters when creating a slice
object. You can set your own default regions to exclude, in addition to
those further excluded using <code>exclude_anatomy</code>.</p>
</div>
<div class="section level5">
<h5 id="i-have-regions-torn-and-i-only-want-to-process-one-hemisphere">I have regions torn and I only want to process one hemisphere?<a class="anchor" aria-label="anchor" href="#i-have-regions-torn-and-i-only-want-to-process-one-hemisphere"></a>
</h5>
<p>If one hemisphere is totally ripped or beyond salvage, you can simply
set the <code>hemisphere</code> parameter when you create a slice object
to either <code>left</code> or <code>right</code> to mark this slice for
analysis of only the left or right hemisphere. The default value of
<code>NULL</code> means both hemispheres will be processed. Later when
<code><a href="../reference/exclude_anatomy.html">exclude_anatomy()</a></code> is run, simply omit the unwanted
contralateral hemisphere by setting <code>exclude_hemisphere</code> to
<code>TRUE</code>.</p>
<p>You can take advantage of this feature if as well if there is
laterality in the sectioning, and the left hemisphere needs to be
treated as a separate hemisphere and slice object from the right. Thus,
separate atlas coordinates can be assigned to either hemisphere.</p>
</div>
<div class="section level5">
<h5 id="i-really-only-want-to-process-one-or-two-regions-per-slice">I really only want to process one or two regions per slice<a class="anchor" aria-label="anchor" href="#i-really-only-want-to-process-one-or-two-regions-per-slice"></a>
</h5>
<p>This is an unusual case, but typically happens when a section is
almost completely ripped but there are one or two regions that remain
intact and can still be processed. To solely keep analyzing these
regions per hemisphere (and omit all other regions), enter the regions
to keep as the <code>include_left_regions</code> and
<code>include_right_regions</code> during the
<code><a href="../reference/exclude_anatomy.html">exclude_anatomy()</a></code> step. We do, however, recommend against
processing these sections if they can be avoided to ensure only high
quality sections in the dataset.</p>
<p>Alternatively, this can be used if you are intentionally analyzing
one or two regions using the pipeline, but still taking advantage of the
atlas overlay capabilities. You can optimize registration for these few
regions without regard for registering the whole plate, and use
<code>include_right_regions</code> and <code>include_left_regions</code>
to only process the regions being analyzed. To set these regions
beforehand, you can also enter these as parameters when making a
<code>slice</code> object.</p>
</div>
</div>
<div class="section level4">
<h4 id="i-get-a-graphics-issue">I get a graphics issue<a class="anchor" aria-label="anchor" href="#i-get-a-graphics-issue"></a>
</h4>
<div class="section level5">
<h5 id="could-not-find-function-quartz">Could not find function “quartz”<a class="anchor" aria-label="anchor" href="#could-not-find-function-quartz"></a>
</h5>
<p>If you get the following error:</p>
<pre><code>Error in quartz(width = plate.width * 11.3, height = 7.9) : 
could not find function "quartz"</code></pre>
<p>The function quartz is calling a graphics device driver for the macOS
system, so this error occurs when running the pipeline in Windows or
Linux. Calling <code>quartz</code> is built into some internals of
wholebrain functions. One work around is by running the lines below
every time you load the SMARTTR library if you are running Windows or
Linux (This can only be done on machines/accounts that have access to an
X server.).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quartz</span> <span class="op">&lt;-</span> <span class="va">x11</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michelle Jin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
